<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Estadísticas</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

    <style>
        .sidebar {
            min-height: 100vh;
            background-color: rgb(255, 255, 255, 100);
            min-width: 300px;
        }

        .sidebar a {
            text-decoration: none;
            padding: 14px;
            border-radius: 8px;
            margin: 18px;
            display: flex;
            /* Usamos flexbox para organizar el contenido */
            align-items: center;
            /* Centra verticalmente el texto y el ícono */
            justify-content: space-between;
            /* Espacio entre el texto y el ícono */
        }

        .sidebar a i {
            font-size: 1.2em;
            /* Mueve el ícono a la derecha */
        }

        .sidebar a i.fa-solid.fa-user {
            margin-right: 10px;
            /* Espacio entre el ícono de la izquierda y el texto */
        }

        .sidebar a .text-icon-container {
            display: flex;
            align-items: center;
        }

        .sidebar a .text-icon-container i {
            margin-right: 8px;
            /* Ajustamos el margen del icono para alinearlo mejor */
            vertical-align: middle;
            /* Alinea verticalmente el ícono con el texto */
        }

        .sidebar a:hover {
            background-color: #495057;
            color: rgb(255, 255, 255, 100);
        }

        /* Falta que permanezca el cambio de color al seleccionar una opcion del menu */

        .boton-seleccion {
            background-color: rgba(94, 80, 248, 1);
            color: white;
        }

        /* Cuando se hace clic en el botón */
        .boton-seleccion:active,
        .boton-seleccion:focus {
            background-color: rgb(94, 80, 248, 1);
            color: white;
        }
        #logo{
            background-color: rgb(94, 80, 248, 1);
            border-radius: 0px 0px 20px 20px;
            padding: 0.4rem;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="flex w-auto">
        <!-- Aside -->
        <nav class="col-md-2 d-none d-md-block sidebar">
            <div class="flex items-center justify-center mb-6" id="logo">
                <img src="./images/logo.png" alt="">
            </div>
            <div class="sidebar-menu">
                <a href="index.html"><span class="text-icon-container">
                        <i class="fa-solid fa-user"></i>Leads
                    </span><i class="fa-solid fa-chevron-right"></i></a>
                <a href="estadisticas.html" class="boton-seleccion">Dashboard<i class="fa-solid fa-chevron-right"></i></a>
                <a href="#">Customers<i class="fa-solid fa-chevron-right"></i></a>
            </div>
        </nav>
        <!-- Main -->
        <main class="w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">Estadísticas del CRM</h1>
                <a href="index.html" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Volver al CRM
                </a>
            </div>

            <div class="flex gap-6">
                <div class="bg-white p-6 rounded-lg shadow" style="height: 80%">
                    <h2 class="text-xl font-semibold mb-4">Estado de Contactos</h2>
                    <canvas id="statusChart"></canvas>
                </div>

                <div class="bg-white p-6 rounded-lg shadow w-full">
                    <h2 class="text-xl font-semibold mb-4">Contactos por Día</h2>
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </main>
    </div>


    <script>
        function getContactStats() {
            const contacts = JSON.parse(localStorage.getItem('contacts') || '[]');

            // Estadísticas por estado
            const statusStats = contacts.reduce((acc, contact) => {
                acc[contact.estado] = (acc[contact.estado] || 0) + 1;
                return acc;
            }, {});

            // Estadísticas por día
            const timelineStats = contacts.reduce((acc, contact) => {
                const date = new Date(contact.fechaCarga).toLocaleDateString();
                acc[date] = (acc[date] || 0) + 1;
                return acc;
            }, {});

            return { statusStats, timelineStats };
        }

        function createStatusChart(stats) {
            const ctx = document.getElementById('statusChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(stats),
                    datasets: [{
                        data: Object.values(stats),
                        backgroundColor: [
                            '#60A5FA', // nuevo
                            '#34D399', // iniciado
                            '#FBBF24', // en proceso
                            '#10B981', // exitoso
                            '#EF4444', // no desea
                            '#6B7280', // num incorrecto
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createTimelineChart(stats) {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(stats),
                    datasets: [{
                        label: 'Contactos agregados',
                        data: Object.values(stats),
                        borderColor: '#60A5FA',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const { statusStats, timelineStats } = getContactStats();
            createStatusChart(statusStats);
            createTimelineChart(timelineStats);
        });
    </script>
</body>

</html>